---
layout: single
title: "Note 324 NoSQL, Mongo DB, Pymongo"
toc: true
toc_sticky: true
category: Section3
---

SQL은 관계형 데이터베이스로 관계와 구조가 정해져 있기 때문에 스키마를 짜고, 데이터를 입력하는 데에는 시간이 소요된다. 하지만, 이미 짜여진 스키마를 토대로 데이터를 읽어오기만 하면 되어서
데이터를 읽어온 후에는 데이터가 어느 정도 정제가 되어 있을 것이다. 데이터베이스는 이런 SQL 외에도 NoSQL 이라는 것이 존재한다. 이번 포스팅에서는 NoSQL과 NoSQL 중에서도 문서형으로
데이터를 저장하는 Mongo DB에 대해 정리해보자.

### NoSQL

- 등장배경

NoSQL은 2000년대에 들어서 Web 시장이 크게 발전하면서 저장해야 하는 데이터의 양이 폭발적으로 증가했을 때 등장했다. Web 데이터는 보통 XML, JSON 형태로 처리하는데
기존에 사용하던 관계형 데이터베이스로는 이를 처리하기가 힘들었고 저장공간, 속도 등이 떨어져서 이 DB를 더 큰 서버로 확장시켜서(수직확장) 데이터를 저장했어야 했다. 
하지만, DB를 확장시킬 때 드는 비용이 너무 컸기 때문에 여러 대의 작은 서버를 사용하여 데이터를 저장하는 방법이 등장(수평확장)했고, 이 클러스터링 방법이 수직확장보다 비용이 덜 들었다.

- SQL vs NoSQL

1) 데이터 저장

- 관계형 DB는 미리 작성된 스키마를 기반으로 SQL을 이용해서 데이터를 테이블에 저장한다. 
- NoSQL DB는 key-value, document, wide-column 형식 등의 방식으로 데이터를 저장한다.

2) 스키마(Schema)

- SQL에서는 고정된 형식의 스키마가 필요하다. 수정할 수 있지만, 수정하기 위해서는 DB를 오프라인으로 바꾸고 수정해야한다.
- NoSQL DB는 스키마의 형태가 SQL에 비해 유연하다. 스키마가 아예 없는 것은 아니지만, 행을 추가할 때 즉시 열을 추가한다던지, 모든 열에 대해 데이터를 반드시 입력하지 않아도 된다던지의 장점이 있다.

-> NoSQL이 스키마가 반드시 없는 것은 아니다. RDB가 데이터를 쓸 때 스키마를 맞춘다면, NoSQL DB는 데이터를 읽어올 때 스키마를 어느 정도 맞춰야 한다. 
읽어올 때는 어느정도 사용자가 써놓은 형태에 따라 읽어와야 하기 때문에 어떻게 쓰냐가 어떻게 읽어와야 하는지에 대한 영향을 미치게 된다. NoSQL이라고 너무 비정제된 데이터를 저장한다면
읽어오는 방법이 복잡할 것이다. 따라서 완벽하진 않더라도 적절한 스키마가 있는 것이 좋다.


3) 쿼리(Querying)

- 쿼리는 DB에 정보를 요청하는 행동이다. RDB는 테이블의 형식과 관계에 맞춰서 구조화된 쿼리 언어로 데이터를 요청한다.
- 비관계형 DB의 쿼리는 구조화된 데이터 보다는 데이터 그룹 자체를 조회하는 것에 초점을 두고 있다. 쿼리가 구조화 되지 않아도 데이터 요청이 가능하다. UnQL(Unstructured Query Language)라고 하기도 한다.

4) 확장성(Scalability)

- SQL은 보통 문제가 발생했을 때 더 큰 장치를 사용하는 수직 확장을 사용한다. 수직 확장을 위해서는 높은 메모리,CPU 등 고성능 하드웨어가 요구되기 때문에 비용이 많이 든다.
(SQL은 ACID의 원칙에 따라 트랜잭션이 동시에 발생할 수 없다. 따라서 하나의 DB에서 트랜잭션이 수행되면 다른 DB는 대기하고 있어야하니까 분산 컴퓨팅을 할 수 없어서 수평확장을
하지 안는 것이 좋다.)

- NoSQL로 구성된 DB는 문제가 발생했을 때 여러 대의 작은 장치들을 사용하는 수평 확장을 사용한다. 클라우드 서비스를 이용하고 수직확장보다 더 싼 서버를 여러 대를 두기 때문에 많은 트래픽을 처리할 수 있다. 또한, 클라우드 기반의 인스턴스에 NoSQL DB를 호스팅할 수 있어서, 수직확장보다 비용 효율성이 높다.

### SQL을 사용해야 할 때

1) DB의 ACID 성질을 준수해야 할 때

ACID는 데이터베이스 내에서 일어나는 하나의 트랜잭션의 안전성을 보장하기 위함이라고 정리했다(Note 313 포스팅 참고). ACID 성질을 사용하면 데이터를 처리할 때 이상 징후가 줄어들고,
DB의 무결성을 보호할 수 있다. 그리고 보통 하나의 서버만 사용하는 수직확장으로 문제를 해결해서 NoSQL에 비해 더 좋은 보안 능력을 가지고 있다.

2) DB에 저장하고자 하는 데이터가 구조적이고, 일관적일 때

프로젝트 규모가 많은 서버를 필요하지 않고, 데이터가 어느 정도 구조화 되어 있는 경우 보톤 RDB를 많이 사용한다. 다양한 데이터 유형과 높은 트래픽 처리를 위한 NoSQL의 장점이
굳이 필요하지 않다.

### NoSQL을 사용할 때

1) 데이터가 구조가 거의 또는 전혀 있는 대용량 데이터를 저장할 때

NoSQL은 필요에 따라 데이터의 새 유형을 추가할 수 있기 때문에 정형화 되지 않은 많은 데이터를 저장할 때 사용하는 좋다.

2) 클라우드 컴퓨팅 및 저장공간을 최대한 활용해야 할 때

클라우드 기반으로 DB를 구축하면 이용료가 들긴하지만, DB를 수직확장 해야할 때보다 더 져럼한 방법이 될 수 있다. 수직확장 시에 발생하는 비용과 관리 비용에 비해 번거로움 없이
많은 양의 데이터를 처리 할 수 있다.

3) 빠르게 서비스를 구축하고 데이터 구조를 자주 업데이트 해야할 때

NoSQL은 스키마를 미리 짜놓을 필요가 없기 때문에 개발하는 과정에서 시간이 단축된다. 그리고 데이터 구조를 자주 업데이트 해야한다면 스키마를 일일이 수정해주지 않아도 되어서
관계형 DB보다 더 효율적으로 작업할 수 있다.

<br>





<br>


### NoSQL 종류
위에서 NoSQL DB는 데이터를 key-value, document, wide-column 형태로 저장한다고 했다.

1) Key-Value DB: 파이썬의 Dictionary 처럼 데이터를 key,value로 저장한다. key는 속성의 이름이고, value의 속성의 값이다., Redis, Dynamo가 대표적인 key-value 형식 DB이다.

2) 문서형(Document) DB: 데이터를 테이블이 아닌 문서처럼 저장한다. 보통 JSON과 유사한 형식으로 데이터를 문서화한다. 각각 문서는 하나의 속성에 대한 데이터를 가지고 있고(행)
컬렉션으라고 하는 그룹으로 묶어서 관리한다(행이 여러개가 됨). 대표적인 문서형 DB는 MongoDB가 있다.

3) Wide-Column DB: 데이터베이스의 열에 대한 데이터 관리를 집중적으로 한다. 각 열에는 key-value 형식으로 데이터가 저장되고, column families라고 하는 열의 집합체 단위로
데이터를 처리한다. 하나의 행에 많은 열을 포함할 수 있어서 유연성이 높다. 데이터 처리에 필요한 열을 유연하게 선택할 수 있기 때문에 규모가 큰 데이터 분석에 주로 사용된다.
Cassandra, HBase가 대표적인 DB이다.

### MongoDB and Pymongo
문서형 DB중 많이 사용되는 MongoDB는 문서들을 BSON(Binary JSON) 형태로 저장한다. NoSQL의 장점답게 데이터의 정해진 틀이나 타입이 없다. 하지만, 위에서도 언급했듯이
어느 정도 스키마가 있어야 데이터를 읽을 때 더 수월하게 가져올 수 있다. MongoDB Atlas로 클러스터를 생성하고, 파이썬의 Pymongo 패키지를 활용하면 파이썬으로 MongoDB에
접근할 수 있다.









